variables:
  - template: pipeline-templates/global-variables.yml
trigger:
  branches:
    include:
      - master
      - release-*
  paths:
    exclude:
      - README.md
pr: none
jobs:
  - job: Build
    displayName: 'Build and publish .NET Standard SDK and .NET Framework GUI component'
    variables:
      - template: pipeline-templates/job-variables.yml
    pool:
      vmImage: 'windows-latest'
    steps:
      - template: pipeline-templates/build-steps.yml
      - task: AzureKeyVault@1
        inputs:
          azureSubscription: 'OneIdentity.RD.SBox.Safeguard-ServiceConnection'
          KeyVaultName: 'SafeguardBuildSecrets'
          SecretsFilter: 'NugetOrgApiKey'
        displayName: 'Get PowerShell Gallery API key from Sandbox Azure Key Vault'
      - task: NuGetCommand@2
        inputs:
          command: 'push'
          nuGetFeedType: 'external'
          includeNugetOrg: 'true'
          feedsToUse: 'config'
          packagesToPush: '$(Build.ArtifactStagingDirectory)/*.nupkg'
          verbosityPush: 'Detailed'
          arguments: '-ApiKey $(NugetOrgApiKey)'
        displayName: 'Publishing NuGet packages to NuGet.org'
